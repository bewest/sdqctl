# sdk-debug-integration.conv - Quine-like SDK debugging/logging integration workflow
#
# Iteratively implements debugging and logging features from COPILOT-SDK-INTEGRATION.md.
# Each cycle selects a sprint, implements it, tests, and updates the progress tracker.
#
# Usage:
#   cd /path/to/sdqctl
#   sdqctl cycle examples/workflows/sdk-debug-integration.conv \
#     --prologue reports/sdk-debug-integration-tracker.md \
#     --adapter copilot
#
# Quine-like behavior:
# 1. Reads current progress from --prologue (sdk-debug-integration-tracker.md)
# 2. Implements the next incomplete sprint item
# 3. Outputs updated progress with next 3 work items
# 4. Output becomes input for next iteration

MODEL gpt-4
ADAPTER copilot
MODE implement
MAX-CYCLES 3

# === Prompt Injection ===
# CLI --prologue injects the progress tracker
# These add consistent framing
PROLOGUE ---
PROLOGUE ## Session Context
PROLOGUE Branch: {{GIT_BRANCH}} ({{GIT_COMMIT}})
PROLOGUE Date: {{DATETIME}}
PROLOGUE Cycle: {{CYCLE_NUMBER}}/{{MAX_CYCLES}}
PROLOGUE Source: COPILOT-SDK-INTEGRATION.md
PROLOGUE ---

EPILOGUE ---
EPILOGUE ## Implementation Guidelines
EPILOGUE - Make minimal, surgical changes to `sdqctl/adapters/copilot.py`
EPILOGUE - Follow existing patterns in the codebase
EPILOGUE - Run tests: `python -m pytest tests/test_copilot_adapter.py -v`
EPILOGUE - Cite specific file:line references
EPILOGUE - Update the tracker with actual progress, not aspirational

# === Source Context ===
# Core files for SDK integration
EPILOGUE sdqctl/adapters/copilot.py might be important
EPILOGUE sdqctl/COPILOT-SDK-INTEGRATION.md might have some additional context if needed
EPILOGUE sdqctl/core/logging.py logging file might needed

# === Cycle 1: Select Sprint Item ===
PROMPT ## Sprint Selection

You have received the SDK debug integration progress tracker via --prologue.

**Task:** Select the SINGLE next incomplete item from the current sprint to work on.

Selection criteria (in order):
1. First incomplete item in the earliest incomplete sprint
2. Items where dependencies are already complete
3. Items that unblock other work

**Output format:**
```
### Selected Work Item
**Sprint:** [N: Name]
**Item:** [Description from tracker]
**Files to modify:** [List specific files with expected changes]
**Test approach:** [How to verify this works]
**Dependencies satisfied:** [Yes/No with explanation]
```

If all sprints are complete, state that and suggest Phase 2 work.

# === Cycle 2: Implementation ===
PROMPT ## Implementation

Based on your selected item, implement it now.

**Requirements:**
1. Edit the relevant source files
2. Make minimal changes - only what's necessary for this item
3. Follow patterns already in copilot.py (event handling, logging, dataclasses)
4. Add appropriate logging at correct levels:
   - INFO (logger.info): Key events (intent changes, tool start)
   - DEBUG (logger.debug): Details (tool args, timing)
   - TRACE (level 5): Everything (all SDK events)

**Testing:**
Run the tests and fix any failures:
```bash
python -m pytest tests/test_copilot_adapter.py -v --tb=short
```

Actually edit files - do not just show code.

# === Cycle 3: Update Progress ===
PROMPT ## Progress Update

Update the progress tracker with this session's results.

**Edit `reports/sdk-debug-integration-tracker.md` with:**

1. **Mark completed items** - Change `[ ]` to `[x]` for what you implemented
2. **Update sprint status** - ⏳ In Progress, ✅ Complete, or ❌ Blocked
3. **Document barriers** - Any issues encountered
4. **Next 3 work items** - With rationale for priority order

**Required sections:**
```markdown
## Current Session
**Date:** {{DATETIME}}
**Completed:** [item description]
**Files modified:** [list with line counts]
**Tests:** [pass/fail with count]

## Next Three Work Items
| Priority | Sprint | Item | Rationale |
|----------|--------|------|-----------|
| 1 | N | ... | Why next |
| 2 | N | ... | Why next |
| 3 | N | ... | Why next |
```

**Provide the exact next session command:**
```bash
sdqctl cycle examples/workflows/sdk-debug-integration.conv \
  --prologue reports/sdk-debug-integration-tracker.md \
  --adapter copilot
```

# === Output Configuration ===
HEADER # SDK Debug Integration Progress
HEADER ## Session: {{DATETIME}}
HEADER **Branch:** {{GIT_BRANCH}} | **Commit:** {{GIT_COMMIT}}
HEADER ---

FOOTER ---
FOOTER ## Meta
FOOTER Generated by `sdk-debug-integration.conv` - a quine-like workflow.
FOOTER 
FOOTER **Next iteration:**
FOOTER ```bash
FOOTER sdqctl cycle examples/workflows/sdk-debug-integration.conv \
FOOTER   --prologue reports/sdk-debug-integration-tracker.md \
FOOTER   --adapter copilot
FOOTER ```

OUTPUT-FORMAT markdown
OUTPUT-FILE reports/sdk-debug-session-{{DATE}}.md

# === Checkpointing ===
CHECKPOINT-AFTER 1
CHECKPOINT-NAME sdk-sprint-select

CHECKPOINT-AFTER 2
CHECKPOINT-NAME sdk-implement

CHECKPOINT-AFTER 3
CHECKPOINT-NAME sdk-progress-update
