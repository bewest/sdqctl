# component-analysis.conv - Per-component code quality analysis
#
# Purpose: Iterate through components and generate individual analysis reports.
#
# Usage:
#   sdqctl apply examples/workflows/component-analysis.conv \
#     --components "lib/plugins/*.js" \
#     --progress progress.md
#
# Design principles (following QUIRKS.md Q-001/Q-003 guidance):
# 1. Explicit role clarification in PROLOGUE
# 2. Uses "audit" MODE for analysis work
# 3. Component variables ({{COMPONENT_PATH}}) are safe - they refer to target files

MODEL claude-sonnet-4.5
ADAPTER copilot
MODE audit

# === Role Clarification ===
PROLOGUE You are a code quality analyst. Your job is to:
PROLOGUE 1. Analyze code for maintainability and potential issues
PROLOGUE 2. Provide severity-rated findings
PROLOGUE 3. Include specific line references and code examples

# File restrictions - focus only on the component being analyzed
# These will be overridden by --allow-files CLI if provided
ALLOW-FILES ./lib/**/*.js
DENY-FILES ./node_modules/**
DENY-FILES ./**/*.test.js

# Analyze the current component
PROMPT Analyze {{COMPONENT_PATH}} for:
  1. Code quality and maintainability
  2. Potential bugs or edge cases
  3. Security considerations
  4. Documentation completeness

PROMPT Component: {{COMPONENT_NAME}}
  Type: {{COMPONENT_TYPE}}
  Progress: {{ITERATION_INDEX}}/{{ITERATION_TOTAL}}

PROMPT Generate a structured analysis report with:
  - Summary of findings
  - Severity ratings (Critical, High, Medium, Low, Info)
  - Specific recommendations
  - Code examples if applicable

# Output to per-component file
OUTPUT reports/analysis/{{COMPONENT_NAME}}.md
