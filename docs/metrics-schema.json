{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://sdqctl.dev/schemas/metrics.json",
  "title": "Iteration Metrics",
  "description": "Schema for sdqctl iteration metrics collected per session",
  "type": "object",
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "1.0",
      "description": "Schema version for forward compatibility"
    },
    "session_id": {
      "type": "string",
      "description": "Unique session identifier"
    },
    "started_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when session started"
    },
    "ended_at": {
      "type": ["string", "null"],
      "format": "date-time",
      "description": "ISO 8601 timestamp when session ended (null if ongoing)"
    },
    "work_output": {
      "type": "object",
      "description": "Metrics for work completed",
      "properties": {
        "items_completed": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of backlog items completed"
        },
        "lines_changed": {
          "type": "integer",
          "minimum": 0,
          "description": "Total lines added/modified/deleted"
        },
        "tests_added": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of new tests added"
        },
        "files_created": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of new files created"
        },
        "files_modified": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of existing files modified"
        }
      },
      "required": ["items_completed", "lines_changed"]
    },
    "token_efficiency": {
      "type": "object",
      "description": "Token usage metrics",
      "properties": {
        "input_tokens": {
          "type": "integer",
          "minimum": 0,
          "description": "Total input tokens consumed"
        },
        "output_tokens": {
          "type": "integer",
          "minimum": 0,
          "description": "Total output tokens generated"
        },
        "io_ratio": {
          "type": "number",
          "minimum": 0,
          "description": "Output/input token ratio"
        },
        "tokens_per_item": {
          "type": ["number", "null"],
          "minimum": 0,
          "description": "Average tokens per completed item (null if no items)"
        },
        "estimated_cost_usd": {
          "type": ["number", "null"],
          "minimum": 0,
          "description": "Estimated cost in USD (null if pricing unavailable)"
        }
      },
      "required": ["input_tokens", "output_tokens"]
    },
    "duration": {
      "type": "object",
      "description": "Timing metrics",
      "properties": {
        "total_seconds": {
          "type": "number",
          "minimum": 0,
          "description": "Total session duration in seconds"
        },
        "cycles": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of iteration cycles completed"
        },
        "seconds_per_cycle": {
          "type": ["number", "null"],
          "minimum": 0,
          "description": "Average seconds per cycle (null if no cycles)"
        },
        "seconds_per_item": {
          "type": ["number", "null"],
          "minimum": 0,
          "description": "Average seconds per item (null if no items)"
        }
      },
      "required": ["total_seconds", "cycles"]
    },
    "cycles": {
      "type": "array",
      "description": "Per-cycle metrics",
      "items": {
        "type": "object",
        "properties": {
          "cycle_number": {
            "type": "integer",
            "minimum": 1
          },
          "started_at": {
            "type": "string",
            "format": "date-time"
          },
          "ended_at": {
            "type": ["string", "null"],
            "format": "date-time"
          },
          "items_completed": {
            "type": "integer",
            "minimum": 0
          },
          "input_tokens": {
            "type": "integer",
            "minimum": 0
          },
          "output_tokens": {
            "type": "integer",
            "minimum": 0
          }
        },
        "required": ["cycle_number", "started_at"]
      }
    }
  },
  "required": ["schema_version", "session_id", "started_at", "work_output", "token_efficiency", "duration"]
}
